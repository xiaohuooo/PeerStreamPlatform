import{B as U}from"./index-97987e5f.js";import{M as N,_ as G}from"./关闭-16202b4d.js";import{_ as V,F}from"./index-dbfdc15a.js";import{U as y,I as E}from"./user-4d6ce6e2.js";import{_ as T}from"./index-e30e4d93.js";import"./index-2ab3627a.js";import{i as S}from"./index-85da8ab9.js";import{_ as A,o as h,b as p,d as s,e as n,w as i,f,K as v,L as g,M as w,N as D,E as R,p as P,h as z}from"./index-efff4e2c.js";import"./Overflow-18123a28.js";import"./LeftOutlined-c084c154.js";const L={data(){return{modalStyle:null,intervalid:null,modalTitle:"",open:!1,confirmDeleteVisable:!1,clickIP:"",data:[],selectedValue:1,machineip:"",selectedRows:[],selectedRowKeys:[],gpusAdd:[],serverInfo:{cpuusage:"",gpuinfo:[],machineip:"",totalmemory:0,usedmemory:0},gpuInfo:{index:"",name:"",totalMemory:"",usedMemory:""},columns:[{title:"序号",dataIndex:"index",key:"index"},{title:"IP地址",dataIndex:"ip",key:"ip"},{title:"显卡",dataIndex:"gpu",key:"gpu",slots:{customRender:"gpucard"}},{title:"显存",dataIndex:"gpu",key:"gpu",slots:{customRender:"gpumemory"}},{title:"操作",dataIndex:"operation",key:"operation"}],rowSelection:{onChange:(e,t)=>{this.selectedRows=t,this.selectedRowKeys=e}}}},mounted(){y.GetMachineInfo().then(e=>{this.data=e.data.machine,this.data.forEach((t,r)=>{t.gpu.forEach((d,a)=>{})})})},beforeDestroy(){this.intervalid&&clearInterval(this.intervalid)},methods:{SetCpuChart(){var e=this.serverInfo.cpuusage,t=(100-e).toFixed(2),r=S(document.getElementById("cpuchart")),d={title:{text:"CPU详情",textStyle:{color:"#fff"}},tooltip:{trigger:"item"},series:[{name:"CPU详情",type:"pie",radius:"50%",center:["45%","50%"],label:{fontSize:16},data:[{value:e,name:"使用率"+e+"%"},{value:t,name:"空闲率"+t+"%"}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};r.setOption(d)},SetMemoryChart(){var e=Number(this.serverInfo.usedmemory).toFixed(2),t=Number(this.serverInfo.totalmemory-e).toFixed(2),r=S(document.getElementById("memoryhart")),d={title:{text:"内存使用详情",textStyle:{color:"#fff"}},tooltip:{trigger:"item"},series:[{name:"内存使用详情",type:"pie",radius:"50%",center:["45%","50%"],label:{fontSize:16,show:!0},data:[{value:e,name:"已使用"+e+"G"},{value:t,name:"未使用"+t+"G"}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};r.setOption(d)},SetGpuChart(e,t){var r=S(document.getElementById("gpu"+e)),d=t.usedMemory,a=t.totalMemory-d,l={title:{text:t.name+"显存",textStyle:{color:"#fff",fontSize:14}},tooltip:{trigger:"item"},series:[{name:t.name,type:"pie",radius:"50%",center:["40%","50%"],label:{show:!0,fontSize:16},data:[{value:d,name:"已使用"+d+"G"},{value:a,name:"未使用"+a+"G"}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};r.setOption(l)},SetChartData(e){y.GetMachineRate({machineip:e}).then(t=>{t.data.status=="0"&&(this.modalTitle="服务器详情",this.serverInfo=t.data,this.serverInfo.gpuinfo.forEach((r,d)=>{r.index=d+1,r.usedMemory=(r.usedMemory/1024).toFixed(2),r.totalMemory=(r.totalMemory/1024).toFixed(2)}),this.serverInfo.cpuusage=(this.serverInfo.cpuusage*100).toFixed(2),this.serverInfo.totalmemory=(this.serverInfo.totalmemory/1024/1024/1024).toFixed(2),this.serverInfo.usedmemory=(this.serverInfo.usedmemory/1024/1024/1024).toFixed(2),this.gpuInfo=this.serverInfo.gpuinfo[0],this.selectedValue=1,setTimeout(()=>{this.SetCpuChart(),this.SetMemoryChart(),this.serverInfo.gpuinfo.forEach((r,d)=>{this.SetGpuChart(d,r)})},100))})},QueryInfo(e){this.open=!0,this.intervalid||(this.SetChartData(e),this.intervalid=setInterval(()=>{this.SetChartData(e)},1e4))},handleDelete(){var e=this.data.findIndex(t=>t.ip==this.clickIP);this.data.splice(e,1),y.UpdateMachineInfo({machine:this.data}),this.confirmDeleteVisable=!1},DeleteCancel(){this.confirmDeleteVisable=!1},DeleteSingle(e){this.confirmDeleteVisable=!0,this.clickIP=e},DeleteMulti(){this.data=this.data.filter(e=>this.selectedRowKeys.includes(e.index)==!1),y.UpdateMachineInfo({machine:this.data})},OpenDialog(){this.modalTitle="新增服务器",this.open=!0,this.modalStyle="",this.serverInfo={},this.gpuInfo=[],this.selectedValue=null,this.gpusAdd=[]},DeleteGpu(e){this.gpusAdd.splice(e,1)},handleOk(){if(this.modalTitle=="新增服务器"){var e=[];this.gpusAdd.forEach(t=>e.push({gpucard:e.length,gpumemory:t.GpuMemory})),this.data.push({ip:this.machineip,gpu:e}),y.UpdateMachineInfo({machine:this.data}).then(t=>{})}this.open=!1},handleCancel(){this.open=!1,this.intervalid&&(clearInterval(this.intervalid),this.intervalid=null)},handleChange(e){this.gpuInfo=this.serverInfo.gpuinfo.find(t=>t.gpucard==e)},addGpu(){this.gpusAdd.push({NameLabel:"显卡"+(this.gpusAdd.length+1)+"序号",Name:"",GpuLabel:"显卡"+(this.gpusAdd.length+1)+"显存",GpuMemory:""})}}},_=e=>(P("data-v-396f0aeb"),e=e(),z(),e),K={style:{height:"100%"}},X={class:"maincontainer",style:{"background-color":"#1B1B1B","padding-top":"30px","padding-left":"40px",height:"100%","border-radius":"16px","padding-right":"40px"}},Q={class:"split-cell"},j={class:"split-cell"},q={key:0},H=["onClick"],J=["onClick"],W=_(()=>s("img",{src:G,alt:"Close"},null,-1)),Y={key:0,style:{height:"400px",width:"1000px"}},Z={style:{height:"200px",width:"100%",display:"flex"}},$={ref:"cpuchart",id:"cpuchart",style:{height:"200px",width:"600px","margin-left":"0px"}},ee=_(()=>s("div",{id:"memoryhart",style:{height:"200px",width:"600px","margin-left":"120px"}},null,-1)),te={style:{"margin-top":"20px"}},ie=["id"],ae=["onClick"],le=_(()=>s("div",null,null,-1)),oe=_(()=>s("img",{src:G,alt:"Close"},null,-1)),ne=_(()=>s("p",{style:{color:"white"}},"是否确认删除?",-1)),se=_(()=>s("div",null,null,-1));function re(e,t,r,d,a,l){const m=U,B=T,x=E,C=V,O=F,M=N;return h(),p("div",K,[s("div",X,[n(m,{type:"primary",onClick:l.OpenDialog},{default:i(()=>[f(" 新增")]),_:1},8,["onClick"]),n(m,{type:"primary",ghost:"",style:{"margin-left":"10px"},onClick:l.DeleteMulti},{default:i(()=>[f(" 删除")]),_:1},8,["onClick"]),n(B,{style:{height:"100%","margin-top":"20px"},class:"custom-table",columns:a.columns,dataSource:a.data,rowSelection:a.rowSelection,rowKey:"index",pagination:{pageSize:5}},{gpucard:i(({text:o,record:u,index:c,column:I})=>[s("div",Q,[(h(!0),p(v,null,g(u.gpu,(k,b)=>(h(),p("div",{key:b},w(k.gpucard),1))),128))])]),gpumemory:i(({text:o,record:u,index:c,column:I})=>[s("div",j,[(h(!0),p(v,null,g(u.gpu,(k,b)=>(h(),p("div",{key:b},w(k.gpumemory)+" G ",1))),128))])]),bodyCell:i(({column:o,record:u,index:c})=>[o.dataIndex=="index"?(h(),p("span",q,w(c+1),1)):D("",!0),o.dataIndex=="operation"?(h(),p(v,{key:1},[s("a",{onClick:I=>l.QueryInfo(u.ip)},"查看",8,H),s("a",{onClick:I=>l.DeleteSingle(u.ip),style:{"margin-left":"8px"}},"删除",8,J)],64)):D("",!0)]),_:1},8,["columns","dataSource","rowSelection"])]),s("div",null,[n(M,{visible:a.open,"onUpdate:visible":t[1]||(t[1]=o=>a.open=o),mask:"",onOk:l.handleOk,onCancel:l.handleCancel,title:a.modalTitle,style:{height:"600px",width:"1000px",display:"flex"}},{closeIcon:i(()=>[W]),footer:i(()=>[n(m,{onClick:l.handleCancel,type:"primary",ghost:""},{default:i(()=>[f("取消")]),_:1},8,["onClick"]),n(m,{type:"primary",onClick:l.handleOk},{default:i(()=>[f("确定")]),_:1},8,["onClick"])]),default:i(()=>[a.modalTitle=="服务器详情"?(h(),p("div",Y,[s("div",Z,[s("div",$,null,512),ee]),s("div",te,[(h(!0),p(v,null,g(a.serverInfo.gpuinfo,(o,u)=>(h(),p("div",{id:"gpu"+u,style:{height:"200px",width:"600px","margin-left":"0px"}},null,8,ie))),256))])])):a.modalTitle=="新增服务器"?(h(),R(O,{key:1,"label-col":{span:6},"wrapper-col":{span:12},style:{height:"400px",width:"600px"}},{default:i(()=>[n(C,{label:"服务器IP"},{default:i(()=>[n(x,{value:a.machineip,"onUpdate:value":t[0]||(t[0]=o=>a.machineip=o)},null,8,["value"])]),_:1}),(h(!0),p(v,null,g(a.gpusAdd,(o,u)=>(h(),p("div",{key:u},[n(C,{label:o.NameLabel},{default:i(()=>[n(x,{value:o.Name,"onUpdate:value":c=>o.Name=c},null,8,["value","onUpdate:value"])]),_:2},1032,["label"]),n(C,{label:o.GpuLabel,style:{display:"flex"}},{default:i(()=>[n(x,{value:o.GpuMemory,"onUpdate:value":c=>o.GpuMemory=c},null,8,["value","onUpdate:value"]),s("a",{type:"link",style:{"margin-left":"80%","font-size":"16px"},onClick:c=>l.DeleteGpu(u)},"删除",8,ae)]),_:2},1032,["label"]),le]))),128)),n(m,{type:"primary",ghost:"",onClick:l.addGpu},{default:i(()=>[f("添加显卡")]),_:1},8,["onClick"])]),_:1})):D("",!0)]),_:1},8,["visible","onOk","onCancel","title"]),n(M,{visible:a.confirmDeleteVisable,title:"确认删除",onOk:l.handleDelete,onCancel:l.DeleteCancel},{closeIcon:i(()=>[oe]),footer:i(()=>[n(m,{onClick:l.DeleteCancel,type:"primary",ghost:""},{default:i(()=>[f("取消")]),_:1},8,["onClick"]),n(m,{type:"primary",onClick:l.handleDelete},{default:i(()=>[f("确定")]),_:1},8,["onClick"])]),default:i(()=>[ne]),_:1},8,["visible","onOk","onCancel"])]),se])}const ge=A(L,[["render",re],["__scopeId","data-v-396f0aeb"]]);export{ge as default};
