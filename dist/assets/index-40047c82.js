import{B as O}from"./index-5fa0cce1.js";import{M as U,_ as G}from"./关闭-ce7d47e4.js";import{_ as V,F as E}from"./index-11d0786a.js";import{U as y,I as F}from"./user-1b04fff0.js";import{_ as R}from"./index-ebdf65e4.js";import"./index-0d3a9212.js";import{i as S}from"./index-85da8ab9.js";import{_ as T,o as h,b as u,d as n,e as d,w as a,f,K as g,L as x,M as w,N as M,E as A,p as z,h as L}from"./index-8c58eb58.js";import"./Overflow-6df7512e.js";import"./LeftOutlined-becaf547.js";const P={data(){return{modalStyle:null,intervalid:null,modalTitle:"",open:!1,confirmDeleteVisable:!1,clickIP:"",data:[],selectedValue:1,machineip:"",ipReadOnly:!1,selectedRows:[],selectedRowKeys:[],gpusAdd:[],serverInfo:{cpuusage:"",gpuinfo:[],machineip:"",totalmemory:0,usedmemory:0},gpuInfo:{index:"",name:"",totalMemory:"",usedMemory:""},columns:[{title:"序号",dataIndex:"index",key:"index"},{title:"IP地址",dataIndex:"ip",key:"ip"},{title:"显卡序号",dataIndex:"gpu",key:"gpu",slots:{customRender:"gpucard"}},{title:"显存",dataIndex:"gpu",key:"gpu",slots:{customRender:"gpumemory"}},{title:"操作",dataIndex:"operation",key:"operation"}],rowSelection:{onChange:(e,t)=>{this.selectedRows=t,this.selectedRowKeys=e}}}},mounted(){y.GetMachineInfo().then(e=>{this.data=e.data.machine,this.data.forEach((t,i)=>{t.gpu.forEach((o,l)=>{})})})},beforeDestroy(){this.intervalid&&clearInterval(this.intervalid)},methods:{SetCpuChart(){var e=this.serverInfo.cpuusage,t=(100-e).toFixed(2),i=S(document.getElementById("cpuchart")),o={title:{text:"CPU详情",textStyle:{color:"#fff"}},tooltip:{trigger:"item"},series:[{name:"CPU详情",type:"pie",radius:"50%",center:["45%","50%"],label:{fontSize:16,color:"#fff"},data:[{value:e,name:"使用率"+e+"%"},{value:t,name:"空闲率"+t+"%"}],emphasis:{itemStyle:{show:!1,textBorderWidth:0,shadowBlur:0,borderWidth:0,fontSize:18,color:"#fff"},label:{show:!1,textBorderWidth:0,shadowBlur:0,fontSize:18,color:"#fff"}}}]};i.setOption(o)},SetMemoryChart(){var e=Number(this.serverInfo.usedmemory).toFixed(2),t=Number(this.serverInfo.totalmemory-e).toFixed(2),i=S(document.getElementById("memoryhart")),o={title:{text:"内存使用详情",textStyle:{color:"#fff"}},tooltip:{trigger:"item"},series:[{name:"内存使用详情",type:"pie",radius:"50%",center:["45%","50%"],label:{fontSize:16,color:"#fff"},data:[{value:e,name:"已使用"+e+"G"},{value:t,name:"未使用"+t+"G"}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};i.setOption(o)},SetGpuChart(e,t){var i=S(document.getElementById("gpu"+e)),o=t.usedMemory,l=(t.totalMemory-o).toFixed(2),s={title:{text:t.name+"显存",textStyle:{color:"#fff",fontSize:14}},tooltip:{trigger:"item"},series:[{name:t.name,type:"pie",radius:"50%",center:["40%","50%"],label:{fontSize:16,color:"#fff"},data:[{value:o,name:"已使用"+o+"G"},{value:l,name:"未使用"+l+"G"}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};i.setOption(s)},SetChartData(e){y.GetMachineRate({machineip:e}).then(t=>{t.data.status=="0"&&(this.modalTitle="服务器详情",this.serverInfo=t.data,this.serverInfo.gpuinfo.forEach((i,o)=>{i.index=o+1,i.usedMemory=(i.usedMemory/1024).toFixed(2),i.totalMemory=(i.totalMemory/1024).toFixed(2)}),this.serverInfo.cpuusage=(this.serverInfo.cpuusage*100).toFixed(2),this.serverInfo.totalmemory=(this.serverInfo.totalmemory/1024/1024/1024).toFixed(2),this.serverInfo.usedmemory=(this.serverInfo.usedmemory/1024/1024/1024).toFixed(2),this.gpuInfo=this.serverInfo.gpuinfo[0],this.selectedValue=1,setTimeout(()=>{this.SetCpuChart(),this.SetMemoryChart(),this.serverInfo.gpuinfo.forEach((i,o)=>{this.SetGpuChart(o,i)})},100))})},QueryInfo(e){this.open=!0,this.intervalid||(this.SetChartData(e),this.intervalid=setInterval(()=>{this.SetChartData(e)},1e4))},handleDelete(){var e=this.data.findIndex(t=>t.ip==this.clickIP);this.data.splice(e,1),y.UpdateMachineInfo({machine:this.data}),this.confirmDeleteVisable=!1},DeleteCancel(){this.confirmDeleteVisable=!1},DeleteSingle(e){this.confirmDeleteVisable=!0,this.clickIP=e},UpdateInfo(e){this.modalTitle="修改服务器信息",this.ipReadOnly=!0,this.open=!0,this.modalStyle="",this.serverInfo=this.data.find(i=>i.ip==e),this.machineip=this.serverInfo.ip;var t=this.serverInfo.gpu;this.gpusAdd=[],t.forEach((i,o)=>{this.gpusAdd.push({NameLabel:"显卡"+(o+1)+"序号",Name:i.gpucard,GpuLabel:"显卡"+(o+1)+"显存",GpuMemory:i.gpumemory})}),this.gpuInfo=[],this.selectedValue=null},DeleteMulti(){this.data=this.data.filter(e=>this.selectedRowKeys.includes(e.index)==!1),y.UpdateMachineInfo({machine:this.data})},OpenDialog(){this.modalTitle="新增服务器",this.open=!0,this.modalStyle="",this.serverInfo={},this.gpuInfo=[],this.selectedValue=null,this.gpusAdd=[],this.ipReadOnly=!1},DeleteGpu(e){this.gpusAdd.splice(e,1)},handleOk(){if(this.modalTitle=="新增服务器"){var e=[];this.gpusAdd.forEach(i=>e.push({gpucard:Number(i.Name),gpumemory:Number(i.GpuMemory)})),this.data.push({ip:this.machineip,gpu:e}),y.UpdateMachineInfo({machine:this.data}).then(i=>{})}else if(this.modalTitle=="修改服务器信息"){var t=this.data.find(i=>i.ip==this.machineip);t.gpu=[],this.gpusAdd.forEach((i,o)=>t.gpu.push({gpucard:Number(i.Name),gpumemory:Number(i.GpuMemory)})),y.UpdateMachineInfo({machine:this.data}).then(i=>{})}this.open=!1},handleCancel(){this.open=!1,this.intervalid&&(clearInterval(this.intervalid),this.intervalid=null)},handleChange(e){this.gpuInfo=this.serverInfo.gpuinfo.find(t=>t.gpucard==e)},addGpu(){this.gpusAdd.push({NameLabel:"显卡"+(this.gpusAdd.length+1)+"序号",Name:"",GpuLabel:"显卡"+(this.gpusAdd.length+1)+"显存",GpuMemory:""})}}},_=e=>(z("data-v-45028eb2"),e=e(),L(),e),K={style:{height:"100%"}},W={class:"maincontainer",style:{"background-color":"#1B1B1B","padding-top":"30px","padding-left":"40px",height:"100%","border-radius":"16px","padding-right":"40px"}},Q={class:"split-cell"},X={class:"split-cell"},j={key:0},q=["onClick"],H=["onClick"],J=["onClick"],Y=_(()=>n("img",{src:G,alt:"Close"},null,-1)),Z={key:0,style:{height:"400px",width:"1000px"}},$={style:{height:"200px",width:"100%",display:"flex"}},ee={ref:"cpuchart",id:"cpuchart",style:{height:"200px",width:"600px","margin-left":"0px"}},te=_(()=>n("div",{id:"memoryhart",style:{height:"200px",width:"600px","margin-left":"120px"}},null,-1)),ie={style:{"margin-top":"20px"}},ae=["id"],le=["onClick"],oe=_(()=>n("div",null,null,-1)),se=_(()=>n("img",{src:G,alt:"Close"},null,-1)),ne=_(()=>n("p",{style:{color:"white"}},"是否确认删除?",-1)),re=_(()=>n("div",null,null,-1));function de(e,t,i,o,l,s){const m=O,N=R,I=F,C=V,B=E,D=U;return h(),u("div",K,[n("div",W,[d(m,{type:"primary",onClick:s.OpenDialog},{default:a(()=>[f(" 新增")]),_:1},8,["onClick"]),d(m,{type:"primary",ghost:"",style:{"margin-left":"10px"},onClick:s.DeleteMulti},{default:a(()=>[f(" 删除")]),_:1},8,["onClick"]),d(N,{style:{height:"100%","margin-top":"20px"},class:"custom-table",columns:l.columns,dataSource:l.data,rowSelection:l.rowSelection,rowKey:"index",pagination:{pageSize:5}},{gpucard:a(({text:r,record:p,index:c,column:v})=>[n("div",Q,[(h(!0),u(g,null,x(p.gpu,(k,b)=>(h(),u("div",{key:b},w(k.gpucard),1))),128))])]),gpumemory:a(({text:r,record:p,index:c,column:v})=>[n("div",X,[(h(!0),u(g,null,x(p.gpu,(k,b)=>(h(),u("div",{key:b},w(k.gpumemory)+" G ",1))),128))])]),bodyCell:a(({column:r,record:p,index:c})=>[r.dataIndex=="index"?(h(),u("span",j,w(c+1),1)):M("",!0),r.dataIndex=="operation"?(h(),u(g,{key:1},[n("a",{onClick:v=>s.QueryInfo(p.ip)},"查看",8,q),n("a",{onClick:v=>s.UpdateInfo(p.ip),style:{"margin-left":"8px"}},"修改",8,H),n("a",{onClick:v=>s.DeleteSingle(p.ip),style:{"margin-left":"8px"}},"删除",8,J)],64)):M("",!0)]),_:1},8,["columns","dataSource","rowSelection"])]),n("div",null,[d(D,{visible:l.open,"onUpdate:visible":t[1]||(t[1]=r=>l.open=r),mask:"",onOk:s.handleOk,onCancel:s.handleCancel,title:l.modalTitle,style:{height:"600px",width:"1000px",display:"flex"}},{closeIcon:a(()=>[Y]),footer:a(()=>[d(m,{onClick:s.handleCancel,type:"primary",ghost:""},{default:a(()=>[f("取消")]),_:1},8,["onClick"]),d(m,{type:"primary",onClick:s.handleOk},{default:a(()=>[f("确定")]),_:1},8,["onClick"])]),default:a(()=>[l.modalTitle=="服务器详情"?(h(),u("div",Z,[n("div",$,[n("div",ee,null,512),te]),n("div",ie,[(h(!0),u(g,null,x(l.serverInfo.gpuinfo,(r,p)=>(h(),u("div",{id:"gpu"+p,style:{height:"200px",width:"600px","margin-left":"0px"}},null,8,ae))),256))])])):l.modalTitle=="新增服务器"||l.modalTitle=="修改服务器信息"?(h(),A(B,{key:1,"label-col":{span:6},"wrapper-col":{span:12},style:{height:"400px",width:"600px"}},{default:a(()=>[d(C,{label:"服务器IP"},{default:a(()=>[d(I,{value:l.machineip,"onUpdate:value":t[0]||(t[0]=r=>l.machineip=r),readonly:l.ipReadOnly},null,8,["value","readonly"])]),_:1}),(h(!0),u(g,null,x(l.gpusAdd,(r,p)=>(h(),u("div",{key:p},[d(C,{label:r.NameLabel},{default:a(()=>[d(I,{value:r.Name,"onUpdate:value":c=>r.Name=c},null,8,["value","onUpdate:value"])]),_:2},1032,["label"]),d(C,{label:r.GpuLabel,style:{display:"flex"}},{default:a(()=>[d(I,{value:r.GpuMemory,"onUpdate:value":c=>r.GpuMemory=c},null,8,["value","onUpdate:value"]),n("a",{type:"link",style:{"margin-left":"80%","font-size":"16px"},onClick:c=>s.DeleteGpu(p)},"删除",8,le)]),_:2},1032,["label"]),oe]))),128)),d(m,{type:"primary",ghost:"",onClick:s.addGpu},{default:a(()=>[f("添加显卡")]),_:1},8,["onClick"])]),_:1})):M("",!0)]),_:1},8,["visible","onOk","onCancel","title"]),d(D,{visible:l.confirmDeleteVisable,title:"确认删除",onOk:s.handleDelete,onCancel:s.DeleteCancel},{closeIcon:a(()=>[se]),footer:a(()=>[d(m,{onClick:s.DeleteCancel,type:"primary",ghost:""},{default:a(()=>[f("取消")]),_:1},8,["onClick"]),d(m,{type:"primary",onClick:s.handleDelete},{default:a(()=>[f("确定")]),_:1},8,["onClick"])]),default:a(()=>[ne]),_:1},8,["visible","onOk","onCancel"])]),re])}const xe=T(P,[["render",de],["__scopeId","data-v-45028eb2"]]);export{xe as default};
